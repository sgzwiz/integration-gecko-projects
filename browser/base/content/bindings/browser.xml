<?xml version="1.0"?>

<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

<bindings id="firefoxBrowserBindings"
          xmlns="http://www.mozilla.org/xbl"
          xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

  <binding id="remote-browser" extends="chrome://global/content/bindings/browser.xml#browser">

    <implementation type="application/javascript" implements="nsIAccessibleProvider, nsIObserver, nsIDOMEventListener, nsIMessageListener">

      <field name="_jsParentUtils">null</field>

      <property name="jsParentUtils">
        <getter>
          <![CDATA[
            if (this._jsParentUtils)
              return this._jsParentUtils;

            this._jsParentUtils = this.boxObject.QueryInterface(Components.interfaces.nsIContainerBoxObject).jsParent;
            return this._jsParentUtils;
          ]]>
        </getter>
      </property>

      <property name="isRemoteBrowser"
                onget="return (this.getAttribute('remote') == 'true');"
                readonly="true"/>

      <property name="securityUI"
                onget="return null;"/>

      <property name="webNavigation"
                readonly="true">
        <getter>
        <![CDATA[
          return this._remoteWebNavigation;
        ]]>
        </getter>
      </property>

      <field name="_remoteWebProgress">null</field>

      <property name="webProgress"
                readonly="true">
	<getter>
	  <![CDATA[
            if (this.isRemoteBrowser) {
              if (!this._remoteWebProgress)
                this._remoteWebProgress = new RemoteWebProgress(this);
              return this._remoteWebProgress;
            } else {
              return this.docShell.QueryInterface(Components.interfaces.nsIInterfaceRequestor).getInterface(Components.interfaces.nsIWebProgress);
	    }
	  ]]>
	</getter>
      </property>

      <field name="outerContentWindowId">null</field>
      <field name="innerContentWindowId">null</field>

      <field name="_contentTitle">null</field>

      <property name="contentTitle"
                onget="return this._contentTitle"
                readonly="true"/>

      <constructor>
        <![CDATA[
          this.messageManager.loadFrameScript("chrome://browser/content/browser-child.js", true);
          this.messageManager.addMessageListener("DOMTitleChanged", this._messageListener);
          this.webProgress._init();
        ]]>
      </constructor>

      <field name="_messageListener"><![CDATA[
        ({
          self: this,
          receiveMessage: function receiveMessage(aMessage) {
            let self = this.self;
            let json = aMessage.json;

            switch (aMessage.name) {
              case "DOMTitleChanged":
                self._contentTitle = json.title;
                break;
            }
          }
        })
      ]]></field>

    </implementation>

  </binding>

</bindings>
